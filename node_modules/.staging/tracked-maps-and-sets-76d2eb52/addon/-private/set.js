import { createStorage, getValue, setValue, } from 'ember-tracked-storage-polyfill';
export class TrackedSet {
    constructor(existing) {
        this.collection = createStorage(null, () => false);
        this.storages = new Map();
        this.vals = new Set(existing);
    }
    storageFor(key) {
        const storages = this.storages;
        let storage = storages.get(key);
        if (storage === undefined) {
            storage = createStorage(null, () => false);
            storages.set(key, storage);
        }
        return storage;
    }
    dirtyStorageFor(key) {
        const storage = this.storages.get(key);
        if (storage) {
            setValue(storage, null);
        }
    }
    // **** KEY GETTERS ****
    has(value) {
        getValue(this.storageFor(value));
        return this.vals.has(value);
    }
    // **** ALL GETTERS ****
    entries() {
        getValue(this.collection);
        return this.vals.entries();
    }
    keys() {
        getValue(this.collection);
        return this.vals.keys();
    }
    values() {
        getValue(this.collection);
        return this.vals.values();
    }
    forEach(fn) {
        getValue(this.collection);
        this.vals.forEach(fn);
    }
    get size() {
        getValue(this.collection);
        return this.vals.size;
    }
    [Symbol.iterator]() {
        getValue(this.collection);
        return this.vals[Symbol.iterator]();
    }
    get [Symbol.toStringTag]() {
        return this.vals[Symbol.toStringTag];
    }
    // **** KEY SETTERS ****
    add(value) {
        this.dirtyStorageFor(value);
        setValue(this.collection, null);
        this.vals.add(value);
        return this;
    }
    delete(value) {
        this.dirtyStorageFor(value);
        setValue(this.collection, null);
        return this.vals.delete(value);
    }
    // **** ALL SETTERS ****
    clear() {
        this.storages.forEach((s) => setValue(s, null));
        setValue(this.collection, null);
        this.vals.clear();
    }
}
// So instanceof works
Object.setPrototypeOf(TrackedSet.prototype, Set.prototype);
export class TrackedWeakSet {
    constructor(values) {
        this.storages = new WeakMap();
        this.vals = new WeakSet(values);
    }
    storageFor(key) {
        const storages = this.storages;
        let storage = storages.get(key);
        if (storage === undefined) {
            storage = createStorage(null, () => false);
            storages.set(key, storage);
        }
        return storage;
    }
    dirtyStorageFor(key) {
        const storage = this.storages.get(key);
        if (storage) {
            setValue(storage, null);
        }
    }
    has(value) {
        getValue(this.storageFor(value));
        return this.vals.has(value);
    }
    add(value) {
        // Add to vals first to get better error message
        this.vals.add(value);
        this.dirtyStorageFor(value);
        return this;
    }
    delete(value) {
        this.dirtyStorageFor(value);
        return this.vals.delete(value);
    }
    get [Symbol.toStringTag]() {
        return this.vals[Symbol.toStringTag];
    }
}
// So instanceof works
Object.setPrototypeOf(TrackedWeakSet.prototype, WeakSet.prototype);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjLy1wcml2YXRlL3NldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsYUFBYSxFQUNiLFFBQVEsRUFDUixRQUFRLEdBQ1QsTUFBTSxnQ0FBZ0MsQ0FBQztBQUV4QyxNQUFNLE9BQU8sVUFBVTtJQThCckIsWUFBWSxRQUF3RDtRQTdCNUQsZUFBVSxHQUFHLGFBQWEsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFOUMsYUFBUSxHQUFpQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBNEJ6RCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUF6Qk8sVUFBVSxDQUFDLEdBQU07UUFDdkIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUMvQixJQUFJLE9BQU8sR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRWhDLElBQUksT0FBTyxLQUFLLFNBQVMsRUFBRTtZQUN6QixPQUFPLEdBQUcsYUFBYSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMzQyxRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztTQUM1QjtRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFFTyxlQUFlLENBQUMsR0FBTTtRQUM1QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUV2QyxJQUFJLE9BQU8sRUFBRTtZQUNYLFFBQVEsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDekI7SUFDSCxDQUFDO0lBU0Qsd0JBQXdCO0lBQ3hCLEdBQUcsQ0FBQyxLQUFRO1FBQ1YsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUVqQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCx3QkFBd0I7SUFDeEIsT0FBTztRQUNMLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFMUIsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxJQUFJO1FBQ0YsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUxQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVELE1BQU07UUFDSixRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTFCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBRUQsT0FBTyxDQUFDLEVBQStDO1FBQ3JELFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUksSUFBSTtRQUNOLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFMUIsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztJQUN4QixDQUFDO0lBRUQsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1FBQ2YsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUxQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7SUFDdEMsQ0FBQztJQUVELElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7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SUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN2QyxDQUFDO0NBQ0Y7QUFFRCxzQkFBc0I7QUFDdEIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIFRyYWNrZWRTdG9yYWdlLFxuICBjcmVhdGVTdG9yYWdlLFxuICBnZXRWYWx1ZSxcbiAgc2V0VmFsdWUsXG59IGZyb20gJ2VtYmVyLXRyYWNrZWQtc3RvcmFnZS1wb2x5ZmlsbCc7XG5cbmV4cG9ydCBjbGFzcyBUcmFja2VkU2V0PFQgPSB1bmtub3duPiBpbXBsZW1lbnRzIFNldDxUPiB7XG4gIHByaXZhdGUgY29sbGVjdGlvbiA9IGNyZWF0ZVN0b3JhZ2UobnVsbCwgKCkgPT4gZmFsc2UpO1xuXG4gIHByaXZhdGUgc3RvcmFnZXM6IE1hcDxULCBUcmFja2VkU3RvcmFnZTxudWxsPj4gPSBuZXcgTWFwKCk7XG5cbiAgcHJpdmF0ZSB2YWxzOiBTZXQ8VD47XG5cbiAgcHJpdmF0ZSBzdG9yYWdlRm9yKGtleTogVCk6IFRyYWNrZWRTdG9yYWdlPG51bGw+IHtcbiAgICBjb25zdCBzdG9yYWdlcyA9IHRoaXMuc3RvcmFnZXM7XG4gICAgbGV0IHN0b3JhZ2UgPSBzdG9yYWdlcy5nZXQoa2V5KTtcblxuICAgIGlmIChzdG9yYWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHN0b3JhZ2UgPSBjcmVhdGVTdG9yYWdlKG51bGwsICgpID0+IGZhbHNlKTtcbiAgICAgIHN0b3JhZ2VzLnNldChrZXksIHN0b3JhZ2UpO1xuICAgIH1cblxuICAgIHJldHVybiBzdG9yYWdlO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXJ0eVN0b3JhZ2VGb3Ioa2V5OiBUKTogdm9pZCB7XG4gICAgY29uc3Qgc3RvcmFnZSA9IHRoaXMuc3RvcmFnZXMuZ2V0KGtleSk7XG5cbiAgICBpZiAoc3RvcmFnZSkge1xuICAgICAgc2V0VmFsdWUoc3RvcmFnZSwgbnVsbCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IoKTtcbiAgY29uc3RydWN0b3IodmFsdWVzOiByZWFkb25seSBUW10gfCBudWxsKTtcbiAgY29uc3RydWN0b3IoaXRlcmFibGU6IEl0ZXJhYmxlPFQ+KTtcbiAgY29uc3RydWN0b3IoZXhpc3Rpbmc/OiByZWFkb25seSBUW10gfCBJdGVyYWJsZTxUPiB8IG51bGwgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLnZhbHMgPSBuZXcgU2V0KGV4aXN0aW5nKTtcbiAgfVxuXG4gIC8vICoqKiogS0VZIEdFVFRFUlMgKioqKlxuICBoYXModmFsdWU6IFQpOiBib29sZWFuIHtcbiAgICBnZXRWYWx1ZSh0aGlzLnN0b3JhZ2VGb3IodmFsdWUpKTtcblxuICAgIHJldHVybiB0aGlzLnZhbHMuaGFzKHZhbHVlKTtcbiAgfVxuXG4gIC8vICoqKiogQUxMIEdFVFRFUlMgKioqKlxuICBlbnRyaWVzKCk6IEl0ZXJhYmxlSXRlcmF0b3I8W1QsIFRdPiB7XG4gICAgZ2V0VmFsdWUodGhpcy5jb2xsZWN0aW9uKTtcblxuICAgIHJldHVybiB0aGlzLnZhbHMuZW50cmllcygpO1xuICB9XG5cbiAga2V5cygpOiBJdGVyYWJsZUl0ZXJhdG9yPFQ+IHtcbiAgICBnZXRWYWx1ZSh0aGlzLmNvbGxlY3Rpb24pO1xuXG4gICAgcmV0dXJuIHRoaXMudmFscy5rZXlzKCk7XG4gIH1cblxuICB2YWx1ZXMoKTogSXRlcmFibGVJdGVyYXRvcjxUPiB7XG4gICAgZ2V0VmFsdWUodGhpcy5jb2xsZWN0aW9uKTtcblxuICAgIHJldHVybiB0aGlzLnZhbHMudmFsdWVzKCk7XG4gIH1cblxuICBmb3JFYWNoKGZuOiAodmFsdWUxOiBULCB2YWx1ZTI6IFQsIHNldDogU2V0PFQ+KSA9PiB2b2lkKTogdm9pZCB7XG4gICAgZ2V0VmFsdWUodGhpcy5jb2xsZWN0aW9uKTtcblxuICAgIHRoaXMudmFscy5mb3JFYWNoKGZuKTtcbiAgfVxuXG4gIGdldCBzaXplKCk6IG51bWJlciB7XG4gICAgZ2V0VmFsdWUodGhpcy5jb2xsZWN0aW9uKTtcblxuICAgIHJldHVybiB0aGlzLnZhbHMuc2l6ZTtcbiAgfVxuXG4gIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhYmxlSXRlcmF0b3I8VD4ge1xuICAgIGdldFZhbHVlKHRoaXMuY29sbGVjdGlvbik7XG5cbiAgICByZXR1cm4gdGhpcy52YWxzW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgfVxuXG4gIGdldCBbU3ltYm9sLnRvU3RyaW5nVGFnXSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnZhbHNbU3ltYm9sLnRvU3RyaW5nVGFnXTtcbiAgfVxuXG4gIC8vICoqKiogS0VZIFNFVFRFUlMgKioqKlxuICBhZGQodmFsdWU6IFQpOiB0aGlzIHtcbiAgICB0aGlzLmRpcnR5U3RvcmFnZUZvcih2YWx1ZSk7XG4gICAgc2V0VmFsdWUodGhpcy5jb2xsZWN0aW9uLCBudWxsKTtcblxuICAgIHRoaXMudmFscy5hZGQodmFsdWUpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBkZWxldGUodmFsdWU6IFQpOiBib29sZWFuIHtcbiAgICB0aGlzLmRpcnR5U3RvcmFnZUZvcih2YWx1ZSk7XG4gICAgc2V0VmFsdWUodGhpcy5jb2xsZWN0aW9uLCBudWxsKTtcblxuICAgIHJldHVybiB0aGlzLnZhbHMuZGVsZXRlKHZhbHVlKTtcbiAgfVxuXG4gIC8vICoqKiogQUxMIFNFVFRFUlMgKioqKlxuICBjbGVhcigpOiB2b2lkIHtcbiAgICB0aGlzLnN0b3JhZ2VzLmZvckVhY2goKHMpID0+IHNldFZhbHVlKHMsIG51bGwpKTtcbiAgICBzZXRWYWx1ZSh0aGlzLmNvbGxlY3Rpb24sIG51bGwpO1xuXG4gICAgdGhpcy52YWxzLmNsZWFyKCk7XG4gIH1cbn1cblxuLy8gU28gaW5zdGFuY2VvZiB3b3Jrc1xuT2JqZWN0LnNldFByb3RvdHlwZU9mKFRyYWNrZWRTZXQucHJvdG90eXBlLCBTZXQucHJvdG90eXBlKTtcblxuZXhwb3J0IGNsYXNzIFRyYWNrZWRXZWFrU2V0PFQgZXh0ZW5kcyBvYmplY3QgPSBvYmplY3Q+IGltcGxlbWVudHMgV2Vha1NldDxUPiB7XG4gIHByaXZhdGUgc3RvcmFnZXM6IFdlYWtNYXA8VCwgVHJhY2tlZFN0b3JhZ2U8bnVsbD4+ID0gbmV3IFdlYWtNYXAoKTtcblxuICBwcml2YXRlIHZhbHM6IFdlYWtTZXQ8VD47XG5cbiAgcHJpdmF0ZSBzdG9yYWdlRm9yKGtleTogVCk6IFRyYWNrZWRTdG9yYWdlPG51bGw+IHtcbiAgICBjb25zdCBzdG9yYWdlcyA9IHRoaXMuc3RvcmFnZXM7XG4gICAgbGV0IHN0b3JhZ2UgPSBzdG9yYWdlcy5nZXQoa2V5KTtcblxuICAgIGlmIChzdG9yYWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHN0b3JhZ2UgPSBjcmVhdGVTdG9yYWdlKG51bGwsICgpID0+IGZhbHNlKTtcbiAgICAgIHN0b3JhZ2VzLnNldChrZXksIHN0b3JhZ2UpO1xuICAgIH1cblxuICAgIHJldHVybiBzdG9yYWdlO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXJ0eVN0b3JhZ2VGb3Ioa2V5OiBUKTogdm9pZCB7XG4gICAgY29uc3Qgc3RvcmFnZSA9IHRoaXMuc3RvcmFnZXMuZ2V0KGtleSk7XG5cbiAgICBpZiAoc3RvcmFnZSkge1xuICAgICAgc2V0VmFsdWUoc3RvcmFnZSwgbnVsbCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IodmFsdWVzPzogcmVhZG9ubHkgVFtdIHwgbnVsbCkge1xuICAgIHRoaXMudmFscyA9IG5ldyBXZWFrU2V0KHZhbHVlcyk7XG4gIH1cblxuICBoYXModmFsdWU6IFQpOiBib29sZWFuIHtcbiAgICBnZXRWYWx1ZSh0aGlzLnN0b3JhZ2VGb3IodmFsdWUpKTtcblxuICAgIHJldHVybiB0aGlzLnZhbHMuaGFzKHZhbHVlKTtcbiAgfVxuXG4gIGFkZCh2YWx1ZTogVCk6IHRoaXMge1xuICAgIC8vIEFkZCB0byB2YWxzIGZpcnN0IHRvIGdldCBiZXR0ZXIgZXJyb3IgbWVzc2FnZVxuICAgIHRoaXMudmFscy5hZGQodmFsdWUpO1xuXG4gICAgdGhpcy5kaXJ0eVN0b3JhZ2VGb3IodmFsdWUpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBkZWxldGUodmFsdWU6IFQpOiBib29sZWFuIHtcbiAgICB0aGlzLmRpcnR5U3RvcmFnZUZvcih2YWx1ZSk7XG5cbiAgICByZXR1cm4gdGhpcy52YWxzLmRlbGV0ZSh2YWx1ZSk7XG4gIH1cblxuICBnZXQgW1N5bWJvbC50b1N0cmluZ1RhZ10oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy52YWxzW1N5bWJvbC50b1N0cmluZ1RhZ107XG4gIH1cbn1cblxuLy8gU28gaW5zdGFuY2VvZiB3b3Jrc1xuT2JqZWN0LnNldFByb3RvdHlwZU9mKFRyYWNrZWRXZWFrU2V0LnByb3RvdHlwZSwgV2Vha1NldC5wcm90b3R5cGUpO1xuIl19